module load mc
(echo "File path,tile,name,acquisition_date,acquisition_location"; mc find embls3alias/live-confocal-trec-super-plankton --name "*.zarr" --maxdepth 5 | sort -u | sed 's|^embls3alias|https://s3.embl.de|' | sed 's:/*$::' | awk -F'/' '{name=$NF; sub(/\.zarr$/,"",name); for(i=1;i<=NF;i++){if($i=="live-confocal-trec-super-plankton"){base=i; break}}; d1=$(base+1); d2=$(base+2); d3=$(base+3); sub(/\.ome\.zarr$/,"",d3); tile=d3; if(match(d3,/_([0-9]+)$/,m)){tile=m[1]}; print $0 "," tile "," name "," d2 "," d1}') > live_confocal_trec_super_plankton_BFF.csv
